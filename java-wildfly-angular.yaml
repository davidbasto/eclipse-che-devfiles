schemaVersion: 2.1.0
metadata:
  name: java-wildfly
  version: 2.1.0
projects:
  - name: backend-app-teste
    git:
      remotes:
        origin: "https://github.com/davidbasto/backend-app-teste.git"
      checkoutFrom:
        revision: main

  - name: frontend-app-teste
    git:
      remotes:
        origin: "https://github.com/davidbasto/frontend-app-teste.git"
      checkoutFrom:
        revision: angular-11
components:
    - name: wildfly
      container:
        image: quay.io/wildfly/wildfly-centos7:25.0
        volumeMounts:
          - name: m2-repository
            path: /home/jboss/.m2/repository
        env:
          - value: '256'
            name: GC_MAX_METASPACE_SIZE
          - value: '96'
            name: GC_METASPACE_SIZE
          - value: 'jaxrs-server,microprofile-platform'
            name: GALLEON_PROVISION_LAYERS
          - value: 'false'
            name: S2I_DELETE_SOURCE
          - value: '-Xrunjdwp:transport=dt_socket,address=8000,server=y,suspend=n -Dsun.util.logging.disableCallerCheck=true'
            name: JAVA_OPTS_APPEND
          - value: '-s /home/jboss/.m2/settings.xml -Dmaven.repo.local=/home/jboss/.m2/repository -Dcom.redhat.xpaas.repo.jbossorg'
            name: MVN_ARGS_APPEND
          - value: /projects
            name: S2I_DESTINATION_DIR
          - name: ENV_VAR
            value: value
        endpoints:
          - name: wildfly-http
            targetPort: 8080
            exposure: public
          - name: wildfly-managament
            targetPort: 9990
        memoryRequest: 256M
        memoryLimit: 1536M
        cpuRequest: '0.1'
        cpuLimit: '0.5'
    - name: nodejs 
      container: 
        image: 'quay.io/eclipse/che-nodejs10-community:7.37.2'
        endpoints:
          - name: angular
            targetPort: 4200           
        memoryLimit: 2Gi
commands:
  - id: build
    exec:
      workingDir: '${PROJECTS_ROOT}/backend-app-teste'
      commandLine: 'mvn ${MVN_ARGS_APPEND} -Dmaven.test.skip=true clean package'
      component: wildfly
